<?php
/**
 * /var/www/html/frontend/runtime/giiant/4b7e79a8340461fe629a6ac612644d03
 *
 * @package default
 */

use yii\helpers\Html;
use yii\bootstrap4\ActiveForm;
use yii\bootstrap4\Tabs;
use yii\data\ArrayDataProvider;
use yii\helpers\Url;

/**
 *
 * @var yii\web\View $this
 * @var common\models\Vendor $model
 * @var yii\widgets\ActiveForm $form
 */

?>
<section class="edit-form vendor-form">

    <?php $form = ActiveForm::begin([
		'id' => 'Vendor',
		'layout' => 'horizontal',
		'enableClientValidation' => true,
		'errorSummaryCssClass' => 'error-summary alert alert-danger',
		'fieldConfig' => Yii::$app->params['activeForm']['horizontalFormConfig'],
	]
);
$this->beginBlock('company');
?>
    <div class="row">
        <div class="col-lg">
			<!-- attribute name -->
			<?php echo $form->field($model, 'name')->textInput(['maxlength' => true]) ?>

			<!-- attribute address_1 -->
			<?php echo $form->field($model, 'address_1')->textInput(['maxlength' => true]) ?>

            <!-- attribute address_2 -->
            <?php echo $form->field($model, 'address_2')->textInput(['maxlength' => true]) ?>

            <div class="form-group row">
                <label class="col-sm-2">
                    <?= $model->getAttributeLabel('city').', '.$model->getAttributeLabel('state_id').', '.$model->getAttributeLabel('zip') ?>
                </label>
                <!-- attribute city -->
                <?php echo $form->field($model, 'city', ['template' => '<div class="col-4">{input}{error}{hint}</div>', 'options' => ['tag' => false]])
                    ->textInput(['maxlength' => true]) ?>
                <!-- attribute state_id -->
                <?php echo // generated by schmunk42\giiant\generators\crud\providers\core\RelationProvider::activeField
                $form->field($model, 'state_id', ['template' => '<div class="col-2">{input}{error}{hint}</div>', 'options' => ['tag' => false]])->dropDownList(
                    \yii\helpers\ArrayHelper::map(common\models\State::find()->all(), 'id', '_label'),
                    [
                        'prompt' => 'Select',
                        'disabled' => (isset($relAttributes) && isset($relAttributes['state_id'])),
                    ]
                ); ?>
                <!-- attribute zip -->
                <?php echo $form->field($model, 'zip', ['template' => '<div class="col-2">{input}{error}{hint}</div>', 'options' => ['tag' => false]])
                    ->textInput(['maxlength' => true]) ?>
            </div>
        </div>
    </div>

    <hr/>

    <div class="row">
        <div class="col-lg-6">
            <!-- attribute main_phone -->
            <?php echo $form->field($model, 'main_phone')->textInput(['maxlength' => true]) ?>

            <!-- attribute main_800 -->
            <?php echo $form->field($model, 'main_800')->textInput(['maxlength' => true]) ?>

            <!-- attribute main_fax -->
            <?php echo $form->field($model, 'main_fax')->textInput(['maxlength' => true]) ?>

            <!-- attribute email -->
            <?php echo $form->field($model, 'email')->textInput(['maxlength' => true]) ?>

            <!-- attribute website -->
            <?php echo $form->field($model, 'website')->textInput(['maxlength' => true]) ?>
        </div>
        <div class="col-lg-6">
            <!-- attribute ar_contact -->
            <?php echo $form->field($model, 'ar_contact')->textInput(['maxlength' => true]) ?>

            <!-- attribute other_contact -->
            <?php echo $form->field($model, 'other_contact')->textInput(['maxlength' => true]) ?>

            <!-- attribute account_no -->
            <?php echo $form->field($model, 'account_no')->textInput(['maxlength' => true]) ?>

            <!-- attribute mail_list -->
            <?php echo $form->field($model, 'mail_list')->checkbox() ?>
        </div>
    </div>

    <?php $this->endBlock(); ?>

    <?php $this->beginBlock('contacts'); ?>

    <div class="clearfix">
        <button type="button"
                class="btn btn-sm btn-secondary float-right js-ajax-modal" data-url="<?= Url::toRoute(['vendor/contact-form', 'vendor' => $model->id]) ?>">
            <i class="fas fa fa-plus"></i> <?=Yii::t('app', 'Add')?>
        </button>
    </div>

    <br/>

    <?php $vendorId = $model->id; ?>
    <?= yii\grid\GridView::widget([
        'dataProvider' => new ArrayDataProvider([
            'allModels' => $model->vendorContacts,
        ]),
        'columns' => [
            ['class' => 'yii\grid\SerialColumn'],
            'contact_name',
            [
                'attribute' => 'department.name',
                'label' => Yii::t('app', 'Department'),
            ],
            [
                'attribute' => 'direct_line',
                'label' => Yii::t('app', 'Phone'),
            ],
            'email',
            [
                'class' => 'yii\grid\ActionColumn',
                'template' => '{update} {delete}',
                'buttons' => [
                    'update' => function($name, $model, $key) use ($vendorId) {
                        return Html::a('<i class="fas fa-pencil-alt" aria-hidden="true"></i>', '#', [
                            'class' => 'js-ajax-modal',
                            'data-url' => Url::toRoute(['vendor/contact-form', 'vendor' => $vendorId, 'id' => $model->id])
                        ]);
                    },
                    'delete' => function($name, $model, $key) use ($vendorId) {
                        return Html::a('<i class="fas fa-trash" aria-hidden="true"></i>',
                            ['contact-delete', 'id' => $model->id, 'vendor' => $vendorId],
                            [
                                'data' => [
                                    'confirm' => Yii::t('app', 'Are you sure to delete this contact?'),
                                    'method' => 'post'
                                ]
                            ]
                        );
                    }
                ],
            ],
        ],
    ]); ?>

    <hr/>

    <?php $this->endBlock(); ?>

    <?php $activeTab = Yii::$app->request->get('tab', 'company'); ?>
	<?php echo Tabs::widget([
		'encodeLabels' => false,
		'items' => [
			[
				'label' => Yii::t('app', 'Company'),
				'content' => $this->blocks['company'],
                'active' => ($activeTab == 'company'),
			],
			[
			    'label' => Yii::t('app', 'Defaults')
            ],
            [
                'label' => Yii::t('app', 'Contacts'),
                'content' => $this->blocks['contacts'],
                'active' => ($activeTab == 'contacts'),
                'disabled' => !isset($model->id),
            ],
		]]); ?>

	<hr/>

    <div class="row">
        <div class="col-lg">
            <!-- attribute notes -->
            <?php echo $form->field($model, 'notes')->textarea(['rows' => 6]) ?>
        </div>
    </div>

	<?php echo $form->errorSummary($model); ?>
	<?php echo Html::submitButton('<i class="fas fa fa-check"></i> '.Yii::t('app', ($model->isNewRecord ? 'Create' : 'Save')), ['id' => 'save-' . $model->formName(), 'class' => 'btn btn-success']); ?>
	<?php ActiveForm::end(); ?>
</section>
